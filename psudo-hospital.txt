DIAS_SIMULACION 730,
RELOJ 0, # Ver si esto va en horas o dias
CAMAS_TOTALES 210,
DISPONIBILIDAD_CAMAS [730], = CAMAS_TOTALES
KITS_INICIALES = POISSON(130),
KITS_DISPONIBLES = KITS_INICIALES,
CANTIDAD_HORAS_ATENCION_QUIROFANO 12, # 12 horas
REPOSICION_KIT_DIARIA 4,
TIEMPO_ESPERA_QUIRIFANOS 0,
QUIROFANO_1 0,
QUIROFANO_2 0,
QUIROFANO_3 0,
QUIROFANO_4 0,
COLA_QUIROFANO_1 0,
COLA_QUIROFANO_2 0,
COLA_QUIROFANO_3 0,
COLA_QUIROFANO_4 0,
OCUPACION_QUIROFANO_1 0,
OCUPACION_QUIROFANO_2 0,
OCUPACION_QUIROFANO_3 0,
OCUPACION_QUIROFANO_4 0,
PACIENTES_RECHAZADOS 0,
CIRUGIAS_REPROGRAMADAS 0,
CIRUGIAS_CONCRETADAS 0,
CIRUGIAS_RECHAZADAS 0,



FOR DIA EN DIAS_SIMULACION DO:
    OCUPACION_QUIROFANO_1 = 0
    OCUPACION_QUIROFANO_2 = 0
    OCUPACION_QUIROFANO_3 = 0
    OCUPACION_QUIROFANO_4 = 0
    INCREMENTAR_KITS(REPOSICION_KIT_DIARIA)

    // ORGANIZACION DE LA DEMANDA

    LLEGADAS = GENERAR_DEMANDA_DIARIA (POISSON)
    IF DISPONIBILIDAD_CAMAS[DIA] >= LLEGADAS:
        FOR 1...LLEGADAS DO:
            
            CANT_DIAS_INTERNACION = GENERAR_DIAS_INTERNACION
            ASIGNAR_CAMA(DIA, DISPONIBILIDAD_CAMAS, CANT_DIAS_INTERNACION)
            NECESITA_QUIROFANO = UNIFORM(0,1, LLEGADAS)
            IF NECESITA_QUIROFANO >= 0.43:
                PACIENTE = CREAR_PACIENTE(DIA, DIA+CANT_DIAS_INTERNACION) // PARAMETROS DIA DE INTERNACION Y DIA DE ALTA
                QUIRIFANO = DETERMINAR_QUIRIFANO_CON_DISPONIBILIDAD()
                ASIGNAR_QUIROFANO(PACEINTE, QUIROFANO)
        
    ELSE:
        PACIENTES_RECHAZADOS += LLEGADAS - DISPONIBILIDAD_CAMAS[DIA]
        CAMAS_DISPONIBLES = DISPONIBILIDAD_CAMAS[DIA] 
        FOR 1... CAMAS_DISPONIBLES DO:
            CANT_DIAS_INTERNACION = GENERAR_DIAS_INTERNACION
            ASIGNAR_CAMA(DIA, DISPONIBILIDAD_CAMAS, CANT_DIAS_INTERNACION)
            NECESITA_QUIROFANO = UNIFORM(0,1, LLEGADAS)
            IF NECESITA_QUIROFANO >= 0.43:
                QUIRIFANO = DETERMINAR_QUIRIFANO_CON_DISPONIBILIDAD()
                ASIGNAR_QUIROFANO(DIA+CANT_DIAS_INTERNACION, QUIROFANO)
    
    // INICIO HORARIO ATENCION

    // QUIROFANO 1
    WHILE ((
           (OCUPACION_QUIROFANO_1 <= CANTIDAD_HORAS_ATENCION_QUIROFANO)
        OR (OCUPACION_QUIROFANO_2 <= CANTIDAD_HORAS_ATENCION_QUIROFANO) 
        OR (OCUPACION_QUIROFANO_3 <= CANTIDAD_HORAS_ATENCION_QUIROFANO)
        OR (OCUPACION_QUIROFANO_4 <= CANTIDAD_HORAS_ATENCION_QUIROFANO))
           AND  HAY_KITS)

           IF (OCUPACION_QUIROFANO_1 <= CANTIDAD_HORAS_ATENCION_QUIROFANO>)
              PACIENTE = DESENCOLAR_PACIENTE(COLA_QUIROFANO_1)
              IF DIA <= PACIENTE.DIA_ALTA_PACIENTE
                IF CANTIDAD_KITS >= 1
                    OCUPACION_QUIROFANO_1 += DETERMINAR_TIEMPO_OPERACION(EXPONENCIAL) // EN CASO DE QUE SE EXCEDA LA OPERACION RESPECTO DEL HORARIO DE ATENCION, SE OPERA IGUALMENTE
                    DECREMENTAR_KIT(1)
                    CIRUGIAS_CONCRETADAS += 1
                    TIEMPO_ESPERA_QUIRIFANOS += DIA - PACIENTE.DIA_INTERNACION
                ELSE
                    CIRUGIAS_REPROGRAMADAS += 1
                    ENCOLAR_PACIENTE(PACIENTE, COLA_QUIROFANO_1) // ENCOLAR AL PRINCIPIO
              ELSE
                PACIENTES_RECHAZADOS += 1
                CIRGIAS_RECHAZADAS += 1

            IF (OCUPACION_QUIROFANO_2 <= CANTIDAD_HORAS_ATENCION_QUIROFANO>)
                PACIENTE = DESENCOLAR_PACIENTE(COLA_QUIROFANO_2)
                IF DIA <= PACIENTE.DIA_ALTA_PACIENTE
                  IF CANTIDAD_KITS >= 1
                      OCUPACION_QUIROFANO_2 += DETERMINAR_TIEMPO_OPERACION(EXPONENCIAL) // EN CASO DE QUE SE EXCEDA LA OPERACION RESPECTO DEL HORARIO DE ATENCION, SE OPERA IGUALMENTE
                      DECREMENTAR_KIT(1)
                      CIRUGIAS_CONCRETADAS += 1
                      TIEMPO_ESPERA_QUIRIFANOS += DIA - PACIENTE.DIA_INTERNACION
                  ELSE
                      CIRUGIAS_REPROGRAMADAS += 1
                      ENCOLAR_PACIENTE(PACIENTE, COLA_QUIROFANO_2) // ENCOLAR AL PRINCIPIO
                ELSE
                  PACIENTES_RECHAZADOS += 1
                  CIRGIAS_RECHAZADAS += 1
            
            IF (OCUPACION_QUIROFANO_3 <= CANTIDAD_HORAS_ATENCION_QUIROFANO>)
                PACIENTE = DESENCOLAR_PACIENTE(COLA_QUIROFANO_3)
                IF DIA <= PACIENTE.DIA_ALTA_PACIENTE
                  IF CANTIDAD_KITS >= 1
                      OCUPACION_QUIROFANO_3 += DETERMINAR_TIEMPO_OPERACION(EXPONENCIAL) // EN CASO DE QUE SE EXCEDA LA OPERACION RESPECTO DEL HORARIO DE ATENCION, SE OPERA IGUALMENTE
                      DECREMENTAR_KIT(1)
                      CIRUGIAS_CONCRETADAS += 1
                      TIEMPO_ESPERA_QUIRIFANOS += DIA - PACIENTE.DIA_INTERNACION
                  ELSE
                      CIRUGIAS_REPROGRAMADAS += 1
                      ENCOLAR_PACIENTE(PACIENTE, COLA_QUIROFANO_3) // ENCOLAR AL PRINCIPIO
                ELSE
                    PACIENTES_RECHAZADOS += 1
                    CIRGIAS_RECHAZADAS += 1

            IF (OCUPACION_QUIROFANO_4 <= CANTIDAD_HORAS_ATENCION_QUIROFANO>)
                PACIENTE = DESENCOLAR_PACIENTE(COLA_QUIROFANO_4)
                IF DIA <= PACIENTE.DIA_ALTA_PACIENTE
                  IF CANTIDAD_KITS >= 1
                      OCUPACION_QUIROFANO_4 += DETERMINAR_TIEMPO_OPERACION(EXPONENCIAL) // EN CASO DE QUE SE EXCEDA LA OPERACION RESPECTO DEL HORARIO DE ATENCION, SE OPERA IGUALMENTE
                      DECREMENTAR_KIT(1)
                      CIRUGIAS_CONCRETADAS += 1
                      TIEMPO_ESPERA_QUIRIFANOS += DIA - PACIENTE.DIA_INTERNACION
                  ELSE
                      CIRUGIAS_REPROGRAMADAS += 1
                      ENCOLAR_PACIENTE(PACIENTE, COLA_QUIROFANO_4) // ENCOLAR AL PRINCIPIO
                ELSE
                  PACIENTES_RECHAZADOS += 1
                  CIRGIAS_RECHAZADAS += 1
                

